<!DOCTYPE html>
<html lang="en" class="antialiased">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>DataTables</title>
    <meta name="description" content="">
    <meta name="keywords" content="">
    <link href="https://unpkg.com/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- DataTables CSS -->
    <link href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.dataTables.min.css" rel="stylesheet">

    <!-- DataTables Responsive Extension CSS -->
    <link href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css" rel="stylesheet">
    <!-- JSZip -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <!-- ExcelJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.1.1/exceljs.min.js"></script>
    <style>
        #map {
            height: 1000px;
            width: 100%;
        }

        /* Overrides for Tailwind CSS */
        .dataTables_wrapper select,
        .dataTables_wrapper .dataTables_filter input {
            color: #4a5568;
            padding-left: 1rem;
            padding-right: 1rem;
            padding-top: .5rem;
            padding-bottom: .5rem;
            margin-bottom: .5rem;
            line-height: 1.25;
            border-width: 2px;
            border-radius: .25rem;
            border-color: #edf2f7;
            background-color: #edf2f7;
        }

        table.dataTable.hover tbody tr:hover,
        table.dataTable.display tbody tr:hover {
            background-color: #ebf4ff;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button {
            font-weight: 700;
            border-radius: .25rem;
            border: 1px solid transparent;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button.current {
            color: #fff !important;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, .1), 0 1px 2px 0 rgba(0, 0, 0, .06);
            font-weight: 700;
            border-radius: .25rem;
            background: #f26f6f !important;
            border: 1px solid transparent;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
            color: #fff !important;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, .1), 0 1px 2px 0 rgba(0, 0, 0, .06);
            font-weight: 700;
            border-radius: .25rem;
            background: #f26f6f !important;
            border: 1px solid transparent;
        }

        table.dataTable.no-footer {
            border-bottom: 1px solid #e2e8f0;
            margin-top: 0.75em;
            margin-bottom: 0.75em;
        }
    </style>
</head>


<body class="bg-gray-100 text-gray-900 tracking-wider leading-normal">
    <div class="container mx-auto px-4">
        <h1 class="flex items-center font-sans font-bold break-normal py-8 text-xl md:text-3xl">
            <span class="text-red-500">M Money X</span>&nbsp;<span class="text-green-600">Heiniken</span>
        </h1>
        <ul class="flex mb-5">
            <li class="mr-6">
                <a id="activeTab" href="#" class="text-gray-500 hover:text-blue-800">Codes ທີ່ໃຊ້ແລ້ວ</a>
            </li>
            <li class="mr-6">
                <a id="inactiveTab" href="#" class="text-gray-500 hover:text-blue-800">Codes ທີ່ໃຊ້ແລ້ວ</a>
            </li>
        </ul>

        <!-- Active Table Container -->
        <div id="activeTableContainer">
            <table id="activeTable" class="display responsive nowrap" style="width:100%">
                <thead>
                    <tr class="bg-gray-200">
                        <th class="px-4 py-2">ID</th>
                        <th class="px-4 py-2">Code</th>
                        <th class="px-4 py-2">ເບິໂທ</th>
                        <th class="px-4 py-2">ມູນຄ່າ</th>
                        <th class="px-4 py-2">ວັນທີ່ເຕີມ</th>
                        <th class="px-4 py-2">ສະຖານທີ່</th>
                        <th class="px-4 py-2">ສະຖານະ</th>
                    </tr>
                </thead>
                <tbody class="bg-white">
                    <!-- Active data rendering with EJS or similar templating engine -->
                    <% data.activeRows.forEach(row => { %>
                    <tr class="hover:bg-gray-100">
                        <td class="border px-4 py-2 text-center"><%= row.id %></td>
                        <td class="border px-4 py-2 text-center"><%= row.code %></td>
                        <td class="border px-4 py-2 text-center"><%= row.msisdn %></td>
                        <td class="border px-4 py-2 text-center"><%= row.amount %></td>
                        <td class="border px-4 py-2 text-center"><%= row.created %></td>
                        <td class="border px-4 py-2 text-center"><%=  `${row.latitude}, ${row.longitude}` %></td>
                        <td class="border px-4 py-2 text-center">ໃຊ້ແລ້ວ</td>
                    </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>

        <!-- Inactive Table Container -->
        <!-- id, codes, amount, active, created, remark, tranid, msisdn, tran_date, startdate, enddate, title, location
	FROM public."Redeem";
     -->
        <div id="inactiveTableContainer" style="display:none;">
            <table id="inactiveTable" class="display responsive nowrap" style="width:100%">
                <thead>
                    <tr class="bg-gray-200">
                        <th class="px-4 py-2">ID</th>
                        <th class="px-4 py-2">Code</th>
                        <th class="px-4 py-2">Amount</th>
                        <th class="px-4 py-2">Created</th>
                        <th class="px-4 py-2">Enddate</th>
                        <th class="px-4 py-2">Active</th>
                    </tr>
                </thead>
                <tbody class="bg-white">
                    <!-- Inactive data rendering with EJS or similar templating engine -->
                    <% data.inactiveRows.forEach(row => { %>
                    <tr class="hover:bg-gray-100">
                        <td class="border px-4 py-2 text-center"><%= row.id %></td>
                        <td class="border px-4 py-2 text-center"><%= row.code %></td>
                        <td class="border px-4 py-2 text-center"><%= row.amount %></td>
                        <td class="border px-4 py-2 text-center"><%= row.created %></td>
                        <td class="border px-4 py-2 text-center"><%= row.enddate %></td>
                        <td class="border px-4 py-2 text-center">ຍັງບໍ່ທັນໄດ້ໃຊ້</td>
                    </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>

        <h1>Locations on Google Maps</h1>
        <div id="map"></div>

    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

    <!-- DataTables -->
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>

    <!-- DataTables Initialization -->
    <script>
        $(document).ready(function () {
            var activeTable = $('#activeTable').DataTable({
                responsive: true,
                dom: 'Bfrtip',
                buttons: [
                    'excelHtml5',
                ]
            });

            var inactiveTable = $('#inactiveTable').DataTable({
                responsive: true,
                dom: 'Bfrtip',
                buttons: [
                    'excelHtml5',
                ]
            });

            // Toggle between active and inactive tabs
            $('#activeTab').click(function () {
                $('#activeTableContainer').show();
                $('#map').show();
                $('#inactiveTableContainer').hide();
                activeTable.columns.adjust().draw();
                return false;
            });

            $('#inactiveTab').click(function () {
                $('#activeTableContainer').hide();
                $('#map').hide();
                $('#inactiveTableContainer').show();
                inactiveTable.columns.adjust().draw();
                return false;
            });
        });

        // Initialize and add the map
        var AllOfLocation = [];
        <% data.activeRows.forEach(element => { %>
            console.log("Latitude:", <%= element.latitude %>);
            console.log("Longitude:", <%= element.longitude %>);
            AllOfLocation.push({
                lat: <%= element.latitude %>,
                lng: <%= element.longitude %>
            });
        <% }); %>

        function initMap() {
            var defaultLocation = {
                lat: 13.7563,
                lng: 100.5018
            };
            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 6,
                center: defaultLocation
            });
            // Create markers from AllOfLocation array
            AllOfLocation.forEach(location => {
                var marker = new google.maps.Marker({
                    position: location,
                    map: map,
                    title: "Your title here" // Replace with your actual title logic
                });
            });
        }

        initMap();
    </script>
    <!-- map -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDDs0D4pKWbnAcK8bP9tIvpvPpU364v-So&callback=initMap"
        async defer></script>
</body>

</html>